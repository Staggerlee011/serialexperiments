<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="staggerlee011">
  <meta name="description" content="Terraform remote statefile creation | When you deploy Terraform you&#39;ll want to have a remote state setup to manage team access. For AWS the standard is...">

  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" media="all">
  <link rel="stylesheet" href="/theme/css/font.css" type="text/css" media="all">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/theme/css/style.css" type="text/css" media="all">

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/theme/js/functions.js"></script>

  
 


<meta name="keywords" content="terraform, gist">



  <title>Terraform remote statefile creation</title>

  
</head>

<body class="home blog">
  <div>
    <header class="site-header">
      <nav class="navbar navbar-default" role="navigation">
        <div class="container">
          <div class="row">
            <div class="site-navigation-inner col-sm-12">
              <div class="navbar-header">
                <button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
              </div>
              <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul id="menu-all-pages" class="nav navbar-nav">
                <li class="menu-item"><a href="/index.html" >Home
<i class="fa  fa-lg"></i></a></li>
                <li class="menu-item"><a href="/pages/about.html" >About
<i class="fa  fa-lg"></i></a></li>
              </ul>
              </div>
              <div class="social">   
                <a href="mailto:stebennettsjb@gmail.com" title="Email" >
<i class="fa fa-envelope fa-lg"></i></a>
                <a href="https://github.com/Staggerlee011" title="GitHub" >
<i class="fa fa-github fa-lg"></i></a>
                <a href="https://www.linkedin.com/in/stephenjohnbennett/" title="LInkedin" >
<i class="fa fa-linkedin fa-lg"></i></a>
              </div>
            </div>
          </div>
        </div>
      </nav><!-- .site-navigation -->

      <div class="container">
      <div id="logo">
        <span class="site-name"><a class="navbar-brand" href=""><img width="310" src="images/07.png" class="attachment-full size-full" alt="logo">          </a>
        </span><!-- end of .site-name -->
      </div><!-- end of #logo -->
        <div class="tagline">
        </div>
    </div>

  </header><!-- #masthead -->
  </div>
    <div id="content" class="site-content">
      <div class="container main-content-area">
        <div class="row">
          <div class="main-content-inner col-sm-12 col-md-12">
            <div id="primary" class="content-area">
              <div id="main" class="site-main" role="main">
                <div class="article-container">
<article>
  <div class="blog-item-wrap">
    <div class="post-inner-content">
      <header class="entry-header page-header">
        <span class="cat-item"><time datetime="2020-12-04 00:00:00+00:00">Dec 04, 2020</time></span>
        <h1 class="entry-title"><a href="/terraform-remote-statefile-creation.html">Terraform remote statefile creation</a></h1>
      </header><!-- .entry-header -->
      <div class="fb-like" data-href="/terraform-remote-statefile-creation.html" data-layout="standard" data-action="like" data-show-faces="false" data-share="true"></div>
      <div class="entry-content">
        <p>When you deploy Terraform you'll want to have a remote state setup to manage team access. For AWS the standard is to use S3 bucket. As you cant store the state of bucket IN the bucket, its one of the only things that you have to leave outside of being controlled via the remote state.</p>
<p>For our teams we manage this via still creating the s3 bucket in Terraform and keep the code in source control, this is normally stored in a <code>.state</code> folder along with the other workspaces.</p>
<div class="highlight"><pre><span></span><code><span class="p">-</span> <span class="n">terraform</span>
  <span class="p">-</span> <span class="p">.</span><span class="n">state</span>
  <span class="p">-</span> <span class="n">core</span>
  <span class="p">-</span> <span class="n">eks</span>
  <span class="p">-</span> <span class="n">rds</span>
</code></pre></div>

<p>The below is a gist example of the code we use, id suggest also adding a <code>version.tf</code> in the folder that matches the rest of your workspaces.</p>
<div class="gist">
    <script src='https://gist.github.com/b08b80dad659cd549030e5855a798673.js?file=terraform-statefile-bucket.tf'></script>
    <noscript>
        <pre><code>provider "aws" {
    region = "eu-west-2"
    profile = "xxx"
}

variable "env" {
    description = "Name of AWS environment"
    type = string
    default = "xxx"
}

resource "aws_s3_bucket" "terraform_state" {
    bucket = "${var.env}-statefile"

    # Enable versioning
    versioning {
        enabled = true
    }

    #Enable Server Side Encryption by default
    server_side_encryption_configuration {
        rule {
            apply_server_side_encryption_by_default {
                sse_algorithm = "AES256"
            }
        }
    }

}

# Block ALL public access to statefile bucket
resource "aws_s3_bucket_public_access_block" "terraform_state" {
  bucket = aws_s3_bucket.terraform_state.id

  block_public_acls         = true
  block_public_policy       = true
  ignore_public_acls        = true
  restrict_public_buckets   = true
}</code></pre>
    </noscript>
</div>
      </div><!-- .entry-content -->
      <br /><br />
      <div class="article_meta">
        Tags:
          <a href="/tag/terraform.html">terraform</a>,          <a href="/tag/gist.html">gist</a>      </div>
    </div>
  </div>
</article><!-- #post-## -->
                </div>
              </div><!-- #main -->
          </div><!-- #primary -->
        </div>
      </div><!-- close .row -->
    </div><!-- close .container -->
  </div><!-- close .site-content -->




  <div id="footer-area">
    <footer id="colophon" class="site-footer" role="contentinfo">
      <div class="site-info container">
        <div class="row">
                    <div class="copyright col-md-12">
                    <a href="/pages/privacy-policy">Privacy Policy</a> | 
                    <a href="/pages/terms-and-conditions">Terms & Conditions</a><br />
                    This site uses the <a href="https://github.com/limbenjamin/voce">voce</a> theme by <a href="//limbenjamin.com/">Benjamin Lim</a><br />
                    &copy; 2020 <a href="">staggerlee011</a> </div>
        </div>
      </div><!-- .site-info -->
      <div class="scroll-to-top" style="display: none;"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
    </footer><!-- #colophon -->
  </div>

  <script type="text/javascript">
    window.addEventListener('load', function(){
    if (window.location.pathname != '/' && window.location.pathname != '/index.html'){
      window.scroll(0, document.getElementById('main').offsetTop);
    }})
  </script>




</body>
</html>